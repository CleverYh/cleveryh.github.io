---
layout:     post
title:      Web图像显示由逐行加载变为清晰化加载
subtitle:   渐进式JPEG和交错式PNG
date:       2020-02-15
author:     炸毛
timecost:   5 minutes
# header-style: black
# header-mask: 0.01
# header-img-credit:      Yuhan Chen
# header-img-year:        2019 
header-img-outchain:    false
header-img: img/qwqjiaocuo.png
catalog: true
mathjax: true
live2d:  false
tags:
    - Web
---

通常在网页中看到的图片有两种加载方式，一种从模糊然后逐渐清晰，另一种逐行加载显示清晰的图片。  

![Interleaved](/img/qwqjiaocuo.png)

↑ 交错

![NO Interleaved](/img/qwqnojiaocuo.png)

↑ 无交错

（感谢Github让我们得以体验缓慢加载）

造成这种方式的原因是图片的压缩算法不同。第一种是小波算法，第二种是离散余弦变化。

我个人觉得第一种方式更加优雅。那么怎么实现呢？

##### Adobe Photoshop CC (or other image processing applications)

`文件(F)` -> `导出(E)` -> `存储位Web所用格式（旧版）(Alt+Shift+Ctrl+S)`  
或者直接按 `Alt+Shift+Ctrl+S` 此时弹出导出选项设置框

右上角有预设等等。 

- Progressive JPEG
选择JPEG格式，并在下面的压缩选项勾选 `连续（以多条路径下载）`

- Interleaved png
选择PNG格式，并在下面的压缩选项勾选 `交错（以多条路径下载）`

##### Python Imaging Library (PIL)

The Python Imaging Library (PIL) adds image processing capabilities to your Python interpreter. This library supports many file formats, and provides powerful image processing and graphics capabilities.

```python
import PIL
from exceptions import IOError
img = PIL.Image.open("c:\\...\\...\\in.jpg")
destination = "c:\\...\\...\\test.jpeg"
try:
    img.save(destination, "JPEG", quality=80, optimize=True, progressive=True)
except IOError:
    PIL.ImageFile.MAXBLOCK = img.size[0] * img.size[1]
    img.save(destination, "JPEG", quality=80, optimize=True, progressive=True)
```

#### 评价

- 优点：
    - 渐进式图片一开始大小框架就定好，不会像基本式图片一样，由于尺寸未设定而造成回流——提高的渲染性能；
    - 当某个图片拥有交错特性时，在下载了该图片的1/64后，您可以看到图片外观形状的总体预览；
    -当图片比较大或网络环境差的情况下，加载需要时间，交错显示可以先加载低分辨率，然后慢慢向高分辨率加载，浏览体验较好。

- 缺点：
    - 渐进式图片也有不足，就是吃CPU吃内存。

大尺寸图片建议使用渐进式JPEG或交错式PNG。